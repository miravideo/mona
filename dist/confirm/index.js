{const t=function(){return this||globalThis}(),{Boolean:e,Error:n,Object:i,Promise:a,document:s,window:o}=t,{hasOwnProperty:r,toString:l}={},c=i.call.bind(i.call);t.chrome.app,(t=>{function e(e){for(var a,o,l=e[0],c=e[1],d=e[2],p=0,m=[];p<l.length;p++)o=l[p],i.prototype.hasOwnProperty.call(s,o)&&s[o]&&m.push(s[o][0]),s[o]=0;for(a in c)i.prototype.hasOwnProperty.call(c,a)&&(t[a]=c[a]);for(h&&h(e);m.length;)m.shift()();return r.push.apply(r,d||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,a=1;a<n.length;a++){var o=n[a];0!==s[o]&&(i=!1)}i&&(r.splice(e--,1),t=l(l.s=n[0]))}return t}var a={},s={4:0},r=[];function l(e){if(a[e])return a[e].exports;var n=a[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,l),n.l=!0,n.exports}l.m=t,l.c=a,l.d=(t,e,n)=>{l.o(t,e)||i.defineProperty(t,e,{enumerable:!0,get:n})},l.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&i.defineProperty(t,Symbol.toStringTag,{value:"Module"}),i.defineProperty(t,"__esModule",{value:!0})},l.t=(t,e)=>{if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=i.create(null);if(l.r(n),i.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)l.d(n,a,(e=>t[e]).bind(null,a));return n},l.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return l.d(e,"a",e),e},l.o=(t,e)=>i.prototype.hasOwnProperty.call(t,e),l.p="";var c=o.webpackJsonp=o.webpackJsonp||[],d=c.push.bind(c);c.push=e,c=c.slice();for(var p=0;p<c.length;p++)e(c[p]);var h=d;r.push([177,1,2,0]),n()})({138:(t,e,n)=>{"use strict";var i=n(32);n.n(i).a},139:(t,e,n)=>{(e=n(11)(!1)).push([t.i,'\n.page-confirm h1 {\n    line-height: 1.3;\n    margin: .25rem 0;\n}\n.page-confirm a:not(:hover) {\n    color: unset;\n    text-decoration: none;\n}\n.page-confirm p {\n    margin-top: 1rem;\n}\n.page-confirm .self-start {\n    align-self: flex-start;\n}\n.page-confirm .image {\n    flex: 0 0 48px;\n    align-items: center;\n    justify-content: center;\n    height: 48px; /* reserve the height so it doesn\'t shift when the icon loads*/\n    padding: 0 14px 0 .25rem;\n    box-sizing: content-box;\n}\n.page-confirm .image img {\n      max-width: 100%;\n      max-height: 100%;\n}\n.page-confirm .info {\n    overflow: hidden;\n}\n.page-confirm .info .descr {\n      max-height: 4rem;\n      overflow-y: auto;\n}\n.page-confirm .info .abs-center {\n      position: absolute;\n      margin-left: -47px;\n      cursor: pointer;\n}\n.page-confirm .icon {\n    width: 18px;\n    height: 18px;\n}\n.page-confirm .lists {\n    margin-top: 1rem;\n}\n.page-confirm .lists dl {\n      margin: 0 1rem 1rem 0\n}\n.page-confirm .lists dl[data-type="antifeature"] dd {\n        border: 1px solid rgba(255, 0, 0, .5);\n        background: rgba(255, 0, 0, .05);\n        padding: 2px 6px;\n        max-width: 25em;\n}\n.page-confirm .lists dt {\n      font-weight: bold;\n}\n.page-confirm .lists dd {\n      white-space: pre-wrap;\n      min-width: 5rem;\n      max-height: 10vh;\n      min-height: 1.5rem;\n      overflow-y: auto;\n}\n.page-confirm [data-collapsed] dd {\n      display: none;\n}\n.page-confirm [data-collapsed] dl:focus dd {\n      display: flex;\n      position: absolute;\n      max-height: 50vh;\n      z-index: 100;\n      background: var(--fill-0-5);\n      box-shadow: 1px 3px 9px rgba(128, 128, 128, .5);\n      padding: .5rem;\n}\n.page-confirm [data-collapsed] dt {\n      cursor: pointer;\n}\n.page-confirm [data-collapsed] .toggle {\n      opacity: .3;\n}\n.page-confirm .actions {\n    align-items: center;\n}\n.page-confirm .actions label {\n      align-items: center;\n}\n.page-confirm .actions .status {\n      border-left: 5px solid darkorange;\n      padding: .5em;\n      color: #d33a00;\n      animation: fade-in .5s 1 both;\n}\n.page-confirm .incognito {\n    padding: .25em 0;\n    color: red;\n}\n.page-confirm #confirm {\n    font-weight: bold;\n    background: #d4e2d4;\n    border-color: #75a775;\n    color: darkgreen\n}\n.page-confirm #confirm:hover {\n      border-color: #488148;\n}\n.page-confirm #confirm::after {\n      content: " (" attr(data-hotkey) ")";\n      opacity: .75;\n      font-weight: normal;\n}\n.page-confirm.reinstall #confirm {\n    background: #d1e0ea;\n    border-color: #6699ce;\n    color: #004fc5\n}\n.page-confirm.reinstall #confirm:hover {\n      border-color: #35699f;\n}\n@media (prefers-color-scheme: dark) {\n.page-confirm .incognito {\n      color: orange;\n}\n.page-confirm #confirm {\n      background: #3a5d3a;\n      border-color: #598059;\n      color: #9cd89c\n}\n.page-confirm #confirm:hover {\n        border-color: #80a980;\n}\n.page-confirm.reinstall #confirm {\n      background: #224a73;\n      border-color: #3d6996;\n      color: #9fcdfd\n}\n.page-confirm.reinstall #confirm:hover {\n        border-color: #608cb8;\n}\n}\n.page-confirm .edit-externals .select {\n    resize: vertical\n}\n.page-confirm .edit-externals .select[style] {\n      max-height: 80%;\n}\n@media (max-width: 1599px) {\n.page-confirm >:first-child {\n      min-height: 5em;\n      max-height: 80vh;\n      width: auto !important; /* resetting the inline style attribute if the user resized it*/\n      resize: vertical;\n      overflow-y: auto;\n}\n}\n@media (min-width: 1600px) {\n.page-confirm {\n    flex-direction: row;\n}\n.page-confirm >:first-child {\n      min-width: 30em;\n      max-width: 80%;\n      width: 40%;\n      height: auto !important; /* resetting the inline style attribute if the user resized it*/\n      resize: horizontal;\n      overflow: hidden;\n}\n.page-confirm .info .descr {\n      max-height: 20vh;\n}\n.page-confirm .lists {\n      overflow-y: auto;\n      max-height: 75vh;\n}\n.page-confirm .lists dd {\n      max-height: 30vh;\n}\n.page-confirm .edit-externals {\n      border-top: none;\n      border-left: var(--border);\n}\n}\n.confirm-options label {\n    display: block;\n}\n.confirm-options .vl-dropdown-menu {\n    width: 13rem;\n}\n.vl-tooltip-bottom > i {\n    margin-left: 10px;\n}\n.vl-tooltip-bottom.vl-tooltip-align-left {\n    margin-left: -13px;\n}\n@keyframes fade-in {\nfrom {\n    opacity: 0;\n}\nto {\n    opacity: 1;\n}\n}\n',""]),t.exports=e},140:(t,e,n)=>{var i=n(141);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals),(0,n(12).default)("3c0d2f12",i,!0,{})},141:(t,e,n)=>{(e=n(11)(!1)).push([t.i,"html,\nbody {\n  height: 100%;\n}\n",""]),t.exports=e},177:function(t,n,o){"use strict";o.r(n);var r=o(22),l=(o(26),o(0)),d=(o(24),o(4)),p=(o(53),o(51),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"page-confirm frame flex flex-col h-100",class:{reinstall:t.reinstall}},[n("div",{staticClass:"frame-block"},[n("div",{staticClass:"flex"},[t._m(0),n("div",{staticClass:"info"},[n("h1",[n("div",[n("span",{domProps:{textContent:t._s(t.heading)}}),t.sameCode?n("span",{staticStyle:{"font-weight":"normal"},domProps:{textContent:t._s(t.i18n("msgSameCode"))}}):t._e()]),n("div",{staticClass:"ellipsis",domProps:{textContent:t._s(t.name)}})]),n("div",{staticClass:"flex"},[n("tooltip",{staticClass:"abs-center",attrs:{content:t.i18n("editNavCode"),placement:"right"}},[n("icon",{attrs:{name:"code"}})],1),n("span",{staticClass:"ellipsis",domProps:{textContent:t._s(t.info.url?decodeURIComponent(t.info.url):"...")}})],1),t._l(t.icons,e=>{var i=e[0],a=e[1],s=e[2];return n("a",{key:a,staticClass:"flex",attrs:{target:"_blank",href:i}},[n("tooltip",{staticClass:"abs-center",attrs:{content:s,placement:"right"}},[n("icon",{attrs:{name:a}})],1),n("span",{staticClass:"ellipsis",domProps:{textContent:t._s(decodeURIComponent(i))}})],1)}),n("p",{staticClass:"descr",domProps:{textContent:t._s(t.descr)}}),n("div",{staticClass:"lists flex flex-wrap",attrs:{"data-collapsed":!t.listsShown}},[n("div",{staticClass:"toggle abs-center",on:{click:e=>{t.listsShown=!t.listsShown}}},[t.lists?n("tooltip",{attrs:{content:t.i18n("msgShowHide"),placement:"bottom",align:"left"}},[n("icon",{attrs:{name:"info"}})],1):t._e()],1),t._l(t.lists,(e,i)=>n("dl",{key:i,attrs:{"data-type":i,hidden:!e.length,tabindex:"0"}},[n("dt",{domProps:{textContent:t._s("@"+i)}}),n("dd",{staticClass:"ellipsis",domProps:{textContent:t._s(e)}})]))],2)],2)]),n("div",{staticClass:"flex"},[n("div",{staticClass:"image flex"},[n("img",{attrs:{src:t.safeIcon}})]),n("div",{staticClass:"actions flex flex-wrap mr-2c"},[n("button",{ref:"confirm",attrs:{id:"confirm","data-hotkey":t.confirmHotkey,disabled:!t.installable},domProps:{textContent:t._s(t.reinstall?t.i18n("buttonConfirmReinstallation"):t.i18n("buttonConfirmInstallation"))},on:{click:t.installScript}}),n("button",{domProps:{textContent:t._s(t.i18n("buttonClose"))},on:{click:t.close}}),n("div",{staticClass:"flex flex-col my-1"},[n("setting-check",{attrs:{name:"closeAfterInstall",label:t.i18n("installOptionClose")},on:{change:t.checkClose}}),n("setting-check",{attrs:{name:"trackLocalFile",disabled:t.closeAfterInstall||!t.isLocal},on:{change:t.trackLocalFile}},[n("tooltip",{attrs:{content:t.trackTooltip,disabled:!t.trackTooltip}},[n("span",{domProps:{textContent:t._s(t.i18n("installOptionTrack"))}})])],1)],1),t.message?n("div",{staticClass:"status",attrs:{title:t.error},domProps:{textContent:t._s(t.message)}}):t._e()])]),t.info.incognito?n("div",{staticClass:"incognito",domProps:{textContent:t._s(t.i18n("msgIncognitoChanges"))}}):t._e()]),n("div",{staticClass:"frame-block flex-1 pos-rel"},[t.script?n("vm-externals",{ref:"externals",staticClass:"abs-full",attrs:{"cm-options":t.cmOptions,commands:t.commands,install:{code:t.code,deps:t.deps,url:t.info.url}},model:{value:t.script,callback:e=>{t.script=e},expression:"script"}}):t._e()],1)])}),h=[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"image"},[n("img",{attrs:{src:"/public/images/icon128.png"}})])}],m=o(15),f=o.n(m),g=o(16),u=o(7),b=o(23),x=o(2),y=o(49),v=o(21),w=o(25),C=o(1),k=o(19),_=o(14);const P=5e3,S=3e3,$=2,L=100,I=`${/Mac/.test(navigator.platform)?"Cmd":"Ctrl"}-Enter`,T=i(b.a)({lifetime:S*($+1)});let D,F,M,O,E;var q={components:{Icon:g.a,VmExternals:y.a,SettingCheck:v.a,Tooltip:f.a},data(){return{installable:!1,installed:!1,closeAfterInstall:d.a.get("closeAfterInstall"),message:"",cmOptions:{lineWrapping:!0},code:"",commands:{close:this.close},confirmHotkey:I,info:{},deps:{},descr:"",error:null,heading:this.i18n("msgLoadingData"),lists:null,listsShown:!0,name:"...",reinstall:!1,safeIcon:null,sameCode:!1,script:null}},computed:{trackTooltip(){return _.a.firefox>=68?this.i18n("installOptionTrackTooltip"):null},isLocal(){return!i(l.s)(this.info.url)},icons(){var t;const{homepageURL:n,supportURL:i}=(null==(t=this.script)?void 0:t.meta)||{};return[n&&[n,"home",this.i18n("labelHomepage")],i&&[i,"question",this.i18n("buttonSupport")]].filter(e)}},async mounted(){const t=`confirm-${k.c.paths[0]}`,e=await i(l.y)("CacheLoad",t);this.info=e,e?(M=e.ff>=68&&e.url.startsWith("file:"),E=i(l.y)("CachePop",e.url),this.guard=setInterval(l.y,P,"CacheHit",{key:t}),await this.loadData(),await this.parseMeta(),await a.all([this.checkSameCode(),(async()=>{let t=$;for(;!await this.loadDeps()&&t;)await i(l.t)(S),t-=1})()]),this.installable&&(this.heading=this.reinstall?this.i18n("labelReinstall"):this.i18n("labelInstall")),this.disposeList=[u.c.register(I,()=>this.$refs.confirm.click())],u.c.enable()):this.close()},beforeDestroy(){var t;this.guard&&(clearInterval(this.guard),this.guard=null),null==(t=this.disposeList)||t.forEach(t=>t())},methods:{async loadData(t){this.installable=!1;const e=M?await new a(this.pingFilePort):await this.getScript(this.info.url);if(null==e||t&&this.code===e)throw 0;this.setCode(e)},setCode(t){var e,n;const i=t.split(/\r?\n/),a=null==(e=this.$refs.externals)||null==(n=e.$refs.code)?void 0:n.cm;let s,o=-1;a&&a.eachLine(({text:t})=>(s=t!==i[o+=1],s)),this.code=t,(s||a&&o<i.length-1)&&this.$nextTick(()=>{a.setCursor(o),a.scrollIntoView(null,a.display.lastWrapHeight/3)})},async parseMeta(){const t=await i(l.y)("ParseMeta",this.code),e=i(l.m)(t,"name");s.title=`${e.slice(0,L)}${e.length>L?"...":""} - ${O||(O=s.title)}`,this.name=c(l.B,[e,t.version],", "),this.descr=i(l.m)(t,"description"),this.lists=i(C.i)(t,["antifeature","grant","match","include","exclude","excludeMatch","compatible","connect"],t=>(null==t?void 0:t.map(t=>[t.replace(/^\W+/,"")||t,t]).sort(([t],[e])=>t<e?-1:t>e).map(([,t])=>t).join("\n"))||""),this.script={meta:t,custom:{},props:{}},this.allDeps=[[...new Set(t.require)],[...new Set(i.values(t.resources))]]},async loadDeps(){const{script:t,allDeps:[e,n]}=this;if(this.safeIcon||i(w.a)(t).then(t=>{this.safeIcon=t}),this.require&&i(C.b)(e.slice().sort(),i.keys(this.require).sort())&&i(C.b)(n.slice().sort(),i.keys(this.resources).sort()))return;this.require={},this.resources={};const s=e.length+n.length;let o=0;const r=500,d=performance.now(),p=()=>{performance.now()-d>r&&(this.message=this.i18n("msgLoadingDependency",[o,s]))},h=async(t,e,n)=>{const a=i(l.l)(t,this.info.url),s=`${+n}${t}`;try{const t=await this.getFile(a,{isBlob:n,useCache:!0});e[a]=t,this.deps[s]=t,o+=1,p()}catch(e){return this.deps[s]=!1,t}},m=setTimeout(p,r),f=[...e.map(t=>h(t,this.require,!1)),...n.map(t=>h(t,this.resources,!0))],g=c(l.B,await a.all(f),"\n");if(clearTimeout(m),!g)return this.error=null,this.installable=!0,this.message=null,!0;this.message=this.i18n("msgErrorLoadingDependency"),this.error=g},close(){i(l.y)("TabClose")},async getFile(t,{isBlob:e,useCache:n}={}){const a=e?`blob+${t}`:`text+${t}`;if(n&&T.has(a))return T.get(a);const s=await i(l.w)(t,{responseType:e?"blob":null}),o=e?await x.a.cache.makeRaw(s):s.data;return n&&T.put(a,o),o},async getScript(t){try{return E&&await E||await this.getFile(t)}catch(e){throw this.message=this.i18n("msgErrorLoadingData"),t}finally{E=null}},async installScript(){this.installable=!1;try{const{update:t}=await i(l.y)("ParseScript",{code:this.code,url:this.info.url,from:this.info.from,require:this.require,cache:this.resources}),e=(new Date).toLocaleTimeString(["fr"]),n=this.confirmedTime||(this.confirmedTime=e);this.message=`${t.message} ${n}${n===e?"":` --\x3e ${e}`}`,this.closeAfterInstall?this.close():(this.installed=!0,this.trackLocalFile())}catch(t){this.message=`${t}`,this.installable=!0}},async trackLocalFile(){if(!this.tracking&&this.isLocal&&this.installed){for(E=null,this.tracking=!0;d.a.get("trackLocalFile")&&"stop"!==this.tracking;){await i(l.t)(500);try{await this.loadData(!0),await this.parseMeta(),await this.loadDeps(),await this.installScript(),this.sameCode=!1}catch(t){}}this.tracking=!1}},checkClose(t){this.closeAfterInstall=t,t&&d.a.set("trackLocalFile",!1)},async checkSameCode(){const{name:t,namespace:e}=this.script.meta||{},n=await i(l.y)("GetScript",{meta:{name:t,namespace:e}});this.reinstall=!!n,this.sameCode=n&&this.code===await i(l.y)("GetScriptCode",n.props.id)},createFilePort(){D=browser.tabs.connect(this.info.tabId,{name:"FetchSelf"}),D.onMessage.addListener(t=>{F(t)}),D.onDisconnect.addListener(()=>{this.tracking="stop"})},pingFilePort(t){D||this.createFilePort(),F=t,D.postMessage(null)}}},z=(o(138),o(5)),R=i(z.a)(q,p,h,!1,null,null,null).exports;o(140),r.default.prototype.i18n=l.p,s.title=`${i(l.p)("labelInstall")} - ${i(l.p)("extName")}`,d.a.ready.then(()=>{const t=s.createElement("div");s.body.appendChild(t),new r.default({render:t=>t(R)}).$mount(t)})},32:(t,e,n)=>{var i=n(139);"string"==typeof i&&(i=[[t.i,i,""]]),i.locals&&(t.exports=i.locals),(0,n(12).default)("40e33a8e",i,!0,{})}})}